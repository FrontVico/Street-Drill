<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Usuários</title>
</head>
<body>
    <h1>Cadastro de Usuários</h1>

    <form id="cadastroUsuarioForm">
        <label for="username">Username:</label><br>
        <input type="text" id="user" name="user" required placeholder="Qual nome de usuario deseja"><br><br>

        <label for="nome">Nome:</label><br>
        <input type="text" id="nome" name="nome" required placeholder="Digite seu nome aqui"><br><br>

        <label for="sobrenome">Sobrenome:</label><br>
        <input type="text" id="sobrenome" name="sobrenome" required placeholder="Digite seu sobrenome"><br><br>

        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email" required placeholder="Digite seu melhor email"><br><br>

        <label for="senha">Senha:</label><br>
        <input type="password" id="senha" name="senha" required placeholder="Faça uma senha segura"><br><br>

        <button type="submit">Cadastrar</button>
    </form>
<a href="Login.html"><button>já possuo conta</button></a>
    <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
    <script>
        // Inicializa o Parse com credenciais corretas
        Parse.initialize("OEwZoFZ1YRhiEAKSM3o08SPWscNrLt6kTiWhjWWM", "fplCVBTYJw9iQrfUdB1b7vlkFPdG9OgZFCLhpvz7");
        Parse.serverURL = 'https://parseapi.back4app.com/';

        document.getElementById('cadastroUsuarioForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const username = document.getElementById('user').value;
            const nome = document.getElementById('nome').value;
            const sobrenome = document.getElementById('sobrenome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            // Verificar se os campos estão preenchidos
            if (!nome || !sobrenome || !email || !senha || !username) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            console.log("Iniciando cadastro...");
            console.log("Username:", username);
            console.log("Nome:", nome);
            console.log("Sobrenome:", sobrenome);
            console.log("Email:", email);

            // Criar o usuário usando Parse.User
            const user = new Parse.User();
            user.set('username', username);  // Usar o valor do campo "Username"
            user.set('password', senha);
            user.set('email', email);
            user.set('nome', nome);  // Campo personalizado "nome"
            user.set('sobrenome', sobrenome);  // Campo personalizado "sobrenome"

            try {
                const newUser = await user.signUp();
                console.log("Usuário cadastrado e logado com sucesso:", newUser);
                alert('Usuário cadastrado e logado com sucesso!');
                document.getElementById('cadastroUsuarioForm').reset();
                
                // Redirecionar automaticamente para o perfil do usuário
                window.location.href = "/pages/perfil.html";
            } catch (error) {
                console.error('Erro ao cadastrar usuário:', error);
                alert('Erro ao cadastrar usuário: ' + error.message);
            }
        });
    </script>
</body>
</html>
