<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Street Drill</title>

    <!-- FAVICON -->
    <link rel="icon" href="../assets/favicon.ico" type="image/x-icon">
    <!-- FAVICON -->

    <!-- CSS -->
    <link rel="stylesheet" href="estilos/tailwind.css">
    <link rel="stylesheet" href="estilos/produtos.css">

    <!-- FONTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Freeman&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">

    <!-- ICONS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Parse SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/parse/3.4.4/parse.min.js"></script>

</head>
<body>
    <!-- Loader -->
    <div id="loading">
        <div class="spinner"></div>
    </div>
    <!-- FIM Loader -->

    <!-- NAVBAR -->
    <div class="container">
        <ul class="navbar">
            <li class="links-navbar"><a href="index.html"><i class="bi bi-house"></i></a></li>
            <li class="links-navbar"><a href="pages/carrinho.html"><i class="bi bi-cart3"></i></a></li>
            <li class="links-navbar"><a href="pages/about.html"><i class="bi bi-pencil"></i></a></li>
            <li class="links-navbar"><a href="pages/perfil.html"><i class="bi bi-person"></i></a></li>
        </ul>
    </div>
    <!-- NAVBAR -->

    <!-- HEADER --> 
    <header class="mt-72 w-full h-[320px]">
        <div class="w-full h-full flex flex-col justify-center items-center">
            <img class="shadow-lg w-40 h-40 rounded-full hover:scale-110 duration-300" src="assets/logo.jpeg" alt="Logo da empresa">
            <h1 class="text-3xl font-bold mb-2 mt-4 text-white">Street Drill</h1>
        </div>
    </header>
    <!-- FIM HEADER --> 

    <h2 class="text-4xl md:text-5xl font-bold mt-4 text-center">Nossas roupas</h2>

    <!-- PRODUTOS -->
    <div class="menu" id="menu">
        <main class="grid grid-cols-1 md:grid-cols-2 gap-7 mx-auto max-w-7xl">
            <!-- Os produtos serão renderizados aqui via JavaScript -->
        </main>
    </div>
    <!-- FIM PRODUTOS -->

    <script>
        // Inicializa o Parse SDK com suas credenciais
        Parse.initialize("OEwZoFZ1YRhiEAKSM3o08SPWscNrLt6kTiWhjWWM", "fplCVBTYJw9iQrfUdB1b7vlkFPdG9OgZFCLhpvz7");
        Parse.serverURL = 'https://parseapi.back4app.com/';

        let cart = [];

        // Função para buscar produtos e controlar o loader
        async function fetchAndRenderProducts() {
            const Camisetas = Parse.Object.extend("Camisetas");
            const query = new Parse.Query(Camisetas);

            try {
                // Exibe o loader antes de buscar produtos
                document.getElementById('loading').style.display = 'flex';

                const results = await query.find();
                const productContainer = document.querySelector('#menu main');
                productContainer.innerHTML = ''; // Limpa o conteúdo anterior

                if (results.length === 0) {
                    productContainer.innerHTML = '<p>Nenhum produto encontrado.</p>';
                } else {
                    results.forEach((produto) => {
                        const nome = produto.get("nome");
                        const preco = produto.get("preco");
                        const fotoFrenteFile = produto.get("fotoFrente");

                        if (!nome || !preco || !fotoFrenteFile) {
                            console.error('Produto incompleto:', produto);
                            return;
                        }

                        const fotoFrenteUrl = fotoFrenteFile instanceof Parse.File ? fotoFrenteFile.url() : fotoFrenteFile;

                        const productHtml = `
                        <div class="flex gap-2 p-4 rounded-lg ml-4">
                                <a href="mostruario/mostruario.html">
                                    <img class="w-52 h-52 md:w-80 md:h-80 rounded-2xl bg-cover" src="${fotoFrenteUrl}" alt="${nome}">
                                </a>
                                <div class="ml-3">
                                    <p class="font-bold md:text-3xl text-xl">${nome}</p>
                                    <p class="text-lg">Coleção Exclusiva</p>
                                    <p class="font-bold text-lg">R$ ${preco.toFixed(2)}</p>
                                    <button class="bg-gray-950 text-white px-5 rounded-lg mt-3 add-to-cart" data-name="${nome}" data-price="${preco}" data-foto="${fotoFrenteUrl}">
                                        <i class="bi bi-cart-plus text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                        productContainer.innerHTML += productHtml;
                    });
                }

                // Oculta o loader após renderizar os produtos
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                console.error('Erro ao buscar produtos:', error);
                document.getElementById('loading').style.display = 'none'; // Oculta o loader em caso de erro
            }
        }

        // Função para adicionar produto ao carrinho
        function addToCart(name, price, fotoFrenteUrl) {
            alert("Camisa adicionada ao carrinho");
            const item = { name, price, fotoFrente: fotoFrenteUrl };
            cart.push(item);
            localStorage.setItem('cart', JSON.stringify(cart)); // Salva o carrinho no localStorage
        }

        // Evento de clique para adicionar produtos ao carrinho
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('add-to-cart')) {
                const name = event.target.getAttribute('data-name');
                const price = parseFloat(event.target.getAttribute('data-price'));
                const fotoFrenteUrl = event.target.getAttribute('data-foto');
                addToCart(name, price, fotoFrenteUrl);
            }
        });

        // Chama a função quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchAndRenderProducts);
    </script>
</body>
</html>
