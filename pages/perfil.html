<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Usuário</title>

    <!-- CSS e Icones -->
    <link rel="stylesheet" href="../estilos/perfil.css">
    <link rel="stylesheet" href="../estilos/tailwind.css">
    <link rel="stylesheet" href="../estilos/produtos.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
   <!-- NAVBAR -->
   <div class="container">
    <ul class="navbar">
        <li class="links-navbar"><a href="../index.html"><i class="bi bi-house"></i></a></li>
        <li class="links-navbar"><a href="../pages/carrinho.html"><i class="bi bi-cart3"></i></a></li>
        <li class="links-navbar"><a href="../pages/about.html"><i class="bi bi-pencil"></i></a></li>
        <li class="links-navbar"><a href="../pages/perfil.html"><i class="bi bi-person"></i></a></li>
    </ul>
  </div>
  <!-- NAVBAR -->

  <header class="mt-72 w-full h-[320px]">
    <div class="w-full h-full flex flex-col justify-center items-center">
        <img id="profile-picture-img" class="bg-white shadow-lg w-40 h-40 rounded-full" alt="Foto de Perfil">
        <h2 id="nome-usuario" class="mt-4 text-xl font-bold"></h2>
        <p id="email-usuario" class="text-gray-500"></p>
    </div>
  </header> 

  <!-- Seção de Compras Recentes -->
  <div id="compras-recentes" class="p-4">
      <h2 class="text-2xl font-semibold">Compras Recentes</h2>
      <div id="recent-purchases-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
  </div>

<script>
    // Função para carregar informações do usuário logado
    function loadUserProfile() {
        const user = JSON.parse(localStorage.getItem('loggedUser'));
        
        if (user) {
            document.getElementById('nome-usuario').innerText = `${user.nome} ${user.sobrenome}`;
            document.getElementById('email-usuario').innerText = user.email;
            document.getElementById('profile-picture-img').src = user.fotoPerfil || "../assets/default-profile.png";
        } else {
            // Se não estiver logado, redireciona para a página de login (ou exibe uma mensagem)
            alert("Por favor, faça login para acessar o perfil.");
            window.location.href = "../pages/login.html";
        }
    }

    // Carrega e exibe as compras recentes do localStorage
    function loadRecentPurchases() {
        const comprasRecentes = JSON.parse(localStorage.getItem('comprasRecentes')) || [];
        const recentPurchasesList = document.getElementById('recent-purchases-list');

        if (comprasRecentes.length > 0) {
            comprasRecentes.forEach(compra => {
                const compraHtml = `
                    <div class="compra-item border p-4 rounded-lg shadow">
                        <h3 class="text-lg font-bold">Compra realizada em: ${compra.data}</h3>
                        <p>Cliente: ${compra.nomeCliente}</p>
                        <p>Endereço: ${compra.endereco}</p>
                        <h4 class="mt-2 text-md font-semibold">Itens:</h4>
                        <ul class="mt-1">
                            ${compra.itens.map(item => `
                                <li class="flex items-center mt-2">
                                    <img src="${item.fotoFrente}" alt="${item.name}" class="w-12 h-12 mr-4 rounded">
                                    <div>
                                        <p class="font-semibold">${item.name}</p>
                                        <p>Tamanho: ${item.tamanho}</p>
                                        <p>Preço: R$ ${item.price.toFixed(2)}</p>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                recentPurchasesList.innerHTML += compraHtml;
            });
        } else {
            recentPurchasesList.innerHTML = "<p>Você ainda não realizou compras recentes.</p>";
        }
    }

    // Executa as funções ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
        loadUserProfile();
        loadRecentPurchases();
    });
</script>
</body>
</html>
